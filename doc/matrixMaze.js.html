<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: maze/matrixMaze.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: maze/matrixMaze.js</h1>

    


    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @module
 */
define(['lodash'], function(_) {
  'use strict';
  var exports = {

    /**
    * Create a matrix filled with `def`.
    *
    * @private
    * @param {Number} y Height.
    * @param {Number} x Width.
    * @param {Object} def Default element that the matrix should be filled
    *   with.
    * @returns {Array&lt;Array&lt;Object>>}
    */
    __createEmptyMatrix: function(y, x, def) {
      var matrix = _.range(y).map(function() {
        return _.range(x).map(function() {
          return _.clone(def);
        });
      });
      return matrix;
    },

    /**
    * This function will generate a maze through a variation of the DPS
    * algorithm, see:
    * {@link https://en.wikipedia.org/wiki/Maze_generation_algorithm#Depth-first_search}.
    *
    * This method modified the `matrix` in-place.
    *
    * @private
    * @param {Array&lt;Array&lt;Object>>} matrix A maze matrix.
    * @param {Object} start Object with x and y attributes.
    */
    __createMaze: function(matrix, start) {
      matrix[start.y][start.x].wall = false;
      var randomNeighborCell = _.sample(
        this.getCellNeighbors(matrix, start.y, start.x)
      );
      this.__removeWall(
        matrix, randomNeighborCell.y, randomNeighborCell.x
      );
    },

    /**
     * Attempt to remove the wall at the cell `matrix[y][x]`. Otherwise it does
     * nothing.
     *
     * @private
     * @param {Array&lt;Array&lt;Object>>} matrix A maze matrix.
     * @param {Number} y Y coordinate.
     * @param {Number} x X coordinate.
     * @see {@link module:maze.__createMaze}
     */
    __removeWall: function(matrix, y, x) {
      var neighbors = this.getCellNeighbors(matrix, y, x);
      var wallNeighbors = _.filter(neighbors, function(neighbor) {
        return matrix[neighbor.y][neighbor.x].wall;
      });

      // If only one of the cell's neighbors is a floor it means that's where we
      // came from and that this path is unexplored.
      if (neighbors.length - wallNeighbors.length === 1) {
        matrix[y][x].wall = false;
        wallNeighbors = _.shuffle(wallNeighbors);
        // Visit each of the neighbor walls in random order
        _.each(wallNeighbors, function(element) {
          this.__removeWall(matrix, element.y, element.x);
        }.bind(this));
      }
      // This wall cell is adjacent to two or more floor cells. Removing the wall
      // from this cell would create a loop in the maze.
    },

    /**
     * Get a list with the neighbors of a cell.
     *
     * @param {Array&lt;Array&lt;Object>>} matrix A maze matrix.
     * @param {Number} y Y coordinate.
     * @param {Number} x X coordinate.
     * @returns {Array&lt;Object>} A list with 2, 3 or 4 objects with the
     *   attributes x or y.
     */
    getCellNeighbors: function(matrix, y, x) {
      var neighbors = [];
      if (y > 0) {
        neighbors.push({y: y - 1, x: x});
      }
      if (y &lt; matrix.length - 1) {
        neighbors.push({y: y + 1, x: x});
      }
      if (x > 0) {
        neighbors.push({y: y, x: x - 1});
      }
      if (x &lt; matrix[0].length - 1) {
        neighbors.push({y: y, x: x + 1});
      }
      return neighbors;
    },

    /**
    * Print an ASCII version of the matrix to the console.
    *
    * @example
    * // An example of such a console output:
    *   ------#---
    *   #-#-#-###-
    *   --###-----
    *   -#---##-#-
    *   -#-#---##-
    *   -#--##---#
    *   --#---##--
    *   #--#-#--#-
    *   --#---#-#-
    *   #---#---#-
    *
    * @param {Array&lt;Array&lt;Object>>} matrix A maze matrix.
    */
    printMatrix: function(matrix) {
      var output = '\n';
      _.each(matrix, function(row, i) {
        _.each(row, function(cell, j) {
          output += matrix[i][j].wall ? '#' : '-';
        });
        output += '\n';
      });
      console.log(output);
    },

    /**
     * Generate a maze.
     *
     * @public
     * @param {Object} [args={width: 10, height: 10, start: {x: 0, y: 0}, print: false}]
     *   Arguments object.
     * @returns {Array&lt;Array&lt;Object>>} A maze matrix of objects with an
     *   attribute `wall` that is either true or false.
     */
    generate: function(args) {
      args = _.isUndefined(args) ? {} : args;
      _.defaults(args, {
        width: 10,
        height: 10,
        start: {
          x: 0,
          y: 0,
        },
        print: true,
      });
      var matrix = this.__createEmptyMatrix(10, 10, {wall: true});
      this.__createMaze(matrix, args.start);
      if (args.print) {
        this.printMatrix(matrix);
      }
      return matrix;
    }
  };

  return exports;
});
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Modules</h3><ul><li><a href="Game.html">controller/Game</a></li><li><a href="Key.html">input/Key</a></li><li><a href="creator.html">maze/creator</a></li><li><a href="longestPathFinder.html">maze/longestPathFinder</a></li><li><a href="matrixMaze.html">maze/matrixMaze</a></li><li><a href="obstaclePlacer.html">maze/obstaclePlacer</a></li><li><a href="wallExtractor.html">maze/wallExtractor</a></li><li><a href="Game_.html">model/Game</a></li><li><a href="PriorityQueue.html">structs/PriorityQueue</a></li><li><a href="Game__.html">view/Game</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-alpha5</a> on Fri Aug 29 2014 11:47:38 GMT+0200 (CEST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
